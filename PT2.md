# 第二次笔记
## Verilog表达式
### 表达式
Verilog表达式由操作符和操作数构成,目的是根据操作符的意义得到一个运算结果  
表达式可以在出现数值的任何地方使用
例如
```verilog
a^b;                //a与b进行异或操作
address[9:0]+10'b1; //地址累加
flag1 && flag2;     //逻辑与操作
```
### 操作数
操作数可以是任意的数据类型某些定的语法结构要求使用特定数据类型的操作数  
例如
```verilog
module test

//实数
real a,b,c;
c=a+b;

//寄存器
reg [3:0]   cprmu_1,cprmu2;
always@(posedge clk) begin;
        cprmu_2=cprmu1^cprmu2;
end

//函数
reg flag1;
flag =calculate_result(A,B);

//非法操作数
reg [3:0]   res;
wire[3:0]   temp;
always@(*) begin
    res=cprmu_2-cprmu1_1;
    //temp=cprmu_2-cprmu1_1;//不合法,always块里赋值对象不能是wire型
end
endmodule
```
### 操作符
Verilog提供了大约9种操作符,分别是算数,关系,等价,逻辑,按位,归约,移位,拼接,条件操作符  
<u>大部分操作符与C语言中类似</u>  
不同操作符优先级是不同的,下表列出了优先级从高到低的排列顺序  
| **操作符** | **操作符号**         | **优先级** |
|---------|------------------|---------|
| 单目运算    | \+ \- ！~         | 最高      |
| 乘,除,取模  | \* / %           |         |
| 加减      | \+ \-            |         |
| 移位      | <<    >>         |         |
| 关系      | < <= > >=        |         |
| 等价      | == \!= === \!=== |         |
| 归约      | & ~&             |         |
|         | ^ ~^             |         |
|         | \| ~\|           |         |
| 逻辑      | &&               |         |
|         | \|\|             |         |
| 条件      | ? :              | 最低      |

#### 算术操作符
<u>算术操作符的使用方式和C语言基本相同</u>  

```verilog
reg [3:0] a,b;
reg [4:0] c;
a=4'b0010;      //a的值为2
b=4'b1001;      //b的值为9
c=a+b;          //结果为c=b'1011
c=b/a;          //结果为c=4,取整
```
<u>如果操作数某一位为X,计算结果会**全部出现X**</u>

例如
```verilog
b=4'b100x;
c=a+b;          //结果为c=4'bxxxx
```
对变量进行声名时,要根据实际情况对变量的位宽进行合理的声名  
要避免因为位宽不够导致的结果溢出,溢出时,高位将被截断  
比如说,在使用无符号乘法时,结果变量的位宽应该是两个乘数变量的位宽和  
例如
```verilog
reg [3:0]   mula;
reg [1:0]   mulb;
reg [5:0]   res;
mula=4'he;
mulb=2'h3;
res=mula*mulb;  //结果为res=6'h2a,结果没有丢失位数 
```
加号(+)和减号(-)也可以作为单目运算符使用,用来表示操作符的正负性,此类操作符优先级最高  
负数表示时,可以直接在十进制数字前面加一个减号,也可以指定位宽,因为负数使用二进制补码表示  
不指定位宽来表示负数,编译器会自动分配位宽,造成意想不到的结果  
例如  
```verilog
mula=-4'd4;
mulb=2;
res=mula*mulb;      //计算结果为res=-6'd8,即res=6'h38,正常
res=mula*(-'d4);    //(结果会异常)
```
#### 关系操作符 
关系操作符就是判断大小的四种符号  
关系操作符的正常结果有两种,1和0  
在Verilog中特殊的是:<u>如果操作数字中有一位为x或z,则关系表达式的结果为x</u>  

#### 等价操作符
等价操作符包括
    
    逻辑相等    ==
    逻辑不等    !=
    全等        ===
    非全等      !==
等价操作符的正常结果有两种,1和0  
逻辑相等/不等操作不能比较x或z,当操作数包含一个x或z,则结果为不确定值  
全等比较时,<u>如果按位比较有相同的x或z,返回结果也可以为1,即全等比较也可以比较x或z</u>  
所以全等比较的结果一定不包含x  
例如
```verilog
A=4;
B=8'h04;
C=4'bxxxx;
D=4'hx;
A==B;       //为真
A==(B+1);   //为假
A==C;       //为X不确定
A===C;      //为假,返回值为0
C===D;      //为真,返回值为1 
```
#### 逻辑操作符
逻辑操作符主要有三个:逻辑与(&&),逻辑或(||),逻辑非(!)  
逻辑操作符的计算结果是一个1bit的值,0表示假,1表示真,X表示不确定  
<u>如果一个操作数确定且不为0,则该操作数等价于1  
如果它的任意一位x或z,它等价于x</u>  
如果任意一个操作数包含x,逻辑操作运算符结果不一定为x  
逻辑操作符的操作数可以为变量,也可以为表达式  
例如

```verilog
A=3;
B=0;
C=2'b1x;

A&&B;           //为假
A||B;           //为真
!A;             //为假
!B;             //为真
A&&C;           //为X,不确定
A||C;           //为真,因为A为真
(A==2)&&(!B);   //为真,此时第一个操作数为表达式
```
#### 按位操作符
按位操作符包括:取反(\~),与(&),或(|),异或(^),同或(~\^)  
按位操作符对两个操作数的每一bit数据进行按位操作  
<u>如果2个操作数位宽不等,则用0想左扩展补充较短的操作数</u>  
取反操作只有一个操作数,它对操作数的每1bit数据进行取反操作  
例如  

```verilog
A=4'b0101;
B=4'b1001;
C=4'bx010;

~A;         //4'b1010
A&B;        //4'b0001
A|B;        //4'b1101
A^B;        //4'b1100
A~^B;       //4'b0011
B|C;        //4'b1011
B&C;        //4'bx000
```
#### 归约操作符
归约操作符包括:规约与(&),归约与非(\~&),归约或(|),归约或非(\~|),归约异或(\^),归约同或(~\^)  
归约操作符只有一个操作数,它对这个向量操作数逐位进行操作,最终产生一个1bit结果  
例如
```verilog
A=4'b1010;
&A;         //结果为1&0&1&0=1'b0,可以用来判断向量A是否全为1
~|A;        //结果为~(1|0|1|0)=1'b0,可用来判断变量A是否全为0
^A;         //结果为1^0^1^0=1'b0
```
#### 移位作符
移位操作符包括左移(<<),右移(>>),算术左移(<<<),算术右移(>>>)  
移位操作符是双目运算符,两个操作数分别表示要移位的向量信号(操作符左侧)与移动的位数(操作符右侧)  
算术左移和逻辑左移时,右边低位会补0  
逻辑左移时,左边高位会补0;而算术右移时,左边高位会补充符号位,以保证数据缩小后值的正确性  
例如  
```verilog
A=4'b1100;
B=4'b0010;
A=A>>2;         //结果为4'b0011
A=A<<1;         //结果为4'b1000
A=A<<<1;        //结果为4'b1000
c=B+(A>>>2);    //结果为2+(-4/4)=1,4'b0001
```
#### 拼接操作符
拼接操作符用大括号({,})来表示,用于将多个操作数(向量)拼接成新的操作数(向量),信号间用逗号隔开  
<u>拼接符操作数必须指定位宽,常数的话也需要指定位宽</u>  
例如

```verilog
A=4'b1010;
B=1'b1;
Y1={B,A[3:2],A[0],4'h3};    //结果为Y1='b1100_0011
Y2={4{B},3'd4};             //结果为Y2=7'b111_1110
Y3={32{1'b0}};              //结果为Y3=32h0,常用作寄存器初始化时匹配位宽的赋初值
```
#### 条件操作符
()?(TRUE):(DALSE)  
与C语言的三目运算完全相同  
